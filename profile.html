<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- title -->
    <title>Sky’s The Limit</title>
    <!-- intro -->
    <meta name="description" content="A nifty application for those who want to remain environmentally aware about their actions.">
    <!-- impor base.css-->
    <link rel="stylesheet" href="css/base.css">
    <!-- import common.css-->
    <link rel="stylesheet" href="css/common.css">
    <!-- import index.css-->
    <link rel="stylesheet" href="css/profile.css">
    <!-- import icon -->
    <link rel="shortcut icon" href="Image/logo.png" type="image/x-icon" />
</head>

<body>
    <!-- top starts  -->
    <div class="top">
        <img id="pic" class="profile_picture" src="Image/Avatar-1.png" alt="">
        <div class="info">
            <p id="name">name</p>
        </div>
        <div class="left">
            <a class="notification"></a>
            <a class="settings"></a>
        </div>
    </div>
    <!-- top ends  -->
    <!-- content starts  -->
    <div class="content">
        <div class="starts">
             Stars Earned:
            <p class="number" id="starQty" value=600>600</p>
        </div>
        <a href="starsReward.html">
            <div class="spend">Go Spend My Stars!</div>
        </a>
        <div class="b1">
            <p onclick="star();" class="point">What is stars and how to earn them?</p>
            <p onclick="resetStars()"class="point">Update Stars</p>
        </div>
        <div class="charts">
            <div class="time_bar">
                <ul class="TB">
                    <li>Day</li>
                    <li class="current">Week</li>
                    <li>Month</li>
                    <li>Year</li>
                </ul>
            </div>
            <div class="date">
                <a href="#" class="l"></a>
                <div class="detail">Jan 17-23, 2021</div>
                <a href="#" class="r"></a>
            </div>


            

          <div class="diagram">
            <div class="description">The amount of carbon emission you saved for this week is:</div>
            <!-- had to change id of this  -->
            <div class="number green" id="total1">3.05</div>
            <div class="ton green">tons</div>
            <div class="bar_d">
                <ul>
                  <!-- <li>
                    <div class="name" id="tg">Transportation</div>
                    <div class="num" id="transportation">0.11</div>
                    <div class="ton">tons</div>
                </li> -->
                <!-- <li>
                  <div class="name" id="hg">Household</div>
                  <div class="num" id="Household">0.21</div>
                  <div class="ton">tons</div>
              </li> -->

                
                    <li>
                        <div class="name" id="fg">Food</div>
                        <div class="num" id = "Food">3.05</div>
                        <div class="ton">tons</div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="diagram">
          <div class="description">The amount of carbon emission per year:</div>
          <div class="number green" id="total">3.54</div>
          <div class="ton green">tons</div>
          <div class="bar_d">
              <ul>
                  <li>
                      <div class="name" id="tg">Transportation</div>
                      <div class="num" id="transportation">0.11</div>
                      <div class="ton">tons</div>
                  </li>
              </ul>
              
                  <li>
                      <div class="name" id="hg">Household</div>
                      <div class="num" id="Household">0.21</div>
                      <div class="ton">tons</div>
                  </li>

              </ul>
          </div>
      </div>
        </div>
        <a href="carbonCalculator.html">
            <div class="btn_cal">Calculate your carbon footprint here
            </div>
        </a>
    </div>
    <!-- content ends  -->
    <!-- footer starts  -->
    <div class="footer">
        <div class="info">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="#">Help</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </div>
    </div>
    <!-- footer ends  -->



    <script type="text/javascript">
          //reset star qty to 600
          let resetStars = () => {
                  value = document.getElementById("starQty").getAttribute("value");
                  localStorage.setItem('stars', 600);
                  updateStars();
              }

            //local storage variables
            let transport_value = +localStorage.getItem('carTotal')//getParams("car")
            transport_value = transport_value.toFixed(2)
            let h_value = +localStorage.getItem('houseTotal')//getParams("house");
            h_value = h_value.toFixed(2)
            var totaltotal_value = (+h_value+ +transport_value).toFixed(2)//parseFloat(getParams("Total") + 3.05)
            console.log('transportation: '+ transport_value)
            console.log(h_value)
            console.log(totaltotal_value)
            //end of local storage variables

        updateStars();

    
        window.addEventListener('load', function() {
            document.getElementById("pic").src = getParams("image");
            document.getElementById("name").innerHTML = getParams("userName");
            
        })

        function getParams(key) {
            var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        };
        

    

        function updateStars(){
            let starQty = localStorage.getItem('stars')

            document.getElementById("starQty").innerHTML = starQty;
        }
        

        
        
        
        window.addEventListener('load', function() {
            //setting up profile;
            document.getElementById("pic").src = getParams("image");
            document.getElementById("name").innerHTML = getParams("userName");
            let transportation_value = transport_value;
            let house_value = h_value;
            var total_value = totaltotal_value
            console.log('transport',transportation_value)
            console.log(house_value)
            console.log(total_value)

            // //setting up graph
            // starting_val =  parseFloat(getParams("Total"))
            // if (starting_val){
            // var total_value = parseFloat(getParams("Total") + 3.05)
            // }
            // else {
            //   var total_value = 0;
            // }
            
            
            var food_value = getParams("food");
            var transportGraph = document.getElementById('tg');
            var houseGraph = document.getElementById('hg');
            var foodGraph = document.getElementById('fg');
            var tr_length = (700 * (transportation_value / total_value)).toString() + 'px';
            console.log(tr_length);
            var home_length = (700 * (house_value / total_value)).toString() + 'px';
            console.log(home_length);
            var food_length = (700 * (food_value / total_value)).toString() + 'px';
            console.log(food_length);
            transportGraph.style.width = tr_length;
            houseGraph.style.width = home_length;
            foodGraph.style.width = food_length;

            //count the total co2;

            var total = document.getElementById("total")
            total.innerHTML = total_value;
            var transport = document.getElementById("transportation")
            transport.innerHTML = transportation_value;
            var house = document.getElementById("Household")
            house.innerHTML = house_value;
            var food = document.getElementById("Food")
            food.innerHTML = food_value;
            var count = (parseFloat(transport.innerHTML) + parseFloat(house.innerHTML) + parseFloat(food.innerHTML)).toFixed(2);
            console.log(count);
            if (count.isNaN()){
              console.log('NOT EXISTS')
              count = 0;
            }
            total.innerHTML = count;
            let houseTotal = localStorage.getItem('houseTotal');
            let carTotal = localStorage.getItem('carTotal')
            total.innerHTML = houseTotal+carTotal.toFixed(2);
        })

        function getParams(key) {
            var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        };

        function star() {
            alert("Star points are acquired through ordering produce or participating in environmentally-sound tasks, to which fifty and one hundred points are given respectively. For every four hundred star points earned individuals will be able to choose their reward.")
        }

                var time = document.querySelector('.TB').querySelectorAll('li');
        for (var i = 0; i < time.length; i++) {
            time[i].addEventListener('mouseover', function() {
                for (var j = 0; j < time.length; j++) {
                    time[j].className = '';
                }
                this.className = 'current';
            })
        }
    </script>
</body>

</html>
